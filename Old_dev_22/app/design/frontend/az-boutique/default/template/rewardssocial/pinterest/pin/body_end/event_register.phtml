
<script type="text/javascript">
    var checkPinterestUri = '<?php echo $this->getPinProcessingUri() ?>';
</script>

<script type="text/javascript">
    window.onload = function() {
        var rewardsPinterestKey = null,
            rewardsPinterestObj = null;
        for (var key in window) {
            if (!window.hasOwnProperty(key)) {
                continue;
            }

            if (key.indexOf('PIN_') == -1) {
                continue;
            }

            rewardsPinterestKey = key;
            rewardsPinterestObj = window[key];
            break;
        }

        if (rewardsPinterestKey == null) {
            return;
        }

        var hasPredictedPoints = <?php echo $this->getHasPredictedPoints() ? 'true' : 'false' ?>;
        var rewardsPinItButton = $$('.' + rewardsPinterestKey + '_pin_it_button_20')[0];

        // TODO: this is a hack to be able to show 0 counts
        rewardsPinterestObj.f.call(rewardsPinterestObj.a.endpoint.count+"?url="+encodeURIComponent(window.location.href)+"&amp;ref="+encodeURIComponent(rewardsPinterestObj.v.here)+"&amp;source="+rewardsPinterestObj.a.countSource,
            // callback after fetching pin count
            function(response, someNumber) {
                if (response.count > 0) {
                    return;
                }

                var oldCount = $(rewardsPinterestKey + '_pin_count_0');
                var newCount = $('_pin_count_0');
                if (newCount) {
                    newCount.style.setProperty('display', 'block');
                    newCount.className = rewardsPinterestKey + '_pin_it_button_count';
                    newCount.id = rewardsPinterestKey + '_pin_count_0';
                    oldCount.parentNode.replaceChild(newCount, oldCount);
                }
            }
        );

        var originalOpen = window.open;

        window.open = function(e) {
            var args = Array.prototype.slice.call(arguments);
            var pinterestPinModal = originalOpen.apply(this, args);

            // if PinterestPinReward is not defined, exit
            if (typeof PinterestPinReward === 'undefined' || !hasPredictedPoints || args[0].indexOf('pinterest.com/pin/create/button/') == -1) {
                return pinterestPinModal;
            }

            var _0x4154=["\x32\x20\x67\x3D\x33\x2E\x74\x28\x69\x28\x29\x7B\x6E\x7B\x6D\x28\x66\x3D\x3D\x6A\x7C\x7C\x66\x2E\x7A\x29\x7B\x33\x2E\x6B\x28\x67\x29\x3B\x32\x20\x61\x3D\x72\x2E\x68\x28\x27\x2E\x63\x2D\x6C\x27\x29\x2C\x64\x3D\x61\x2E\x39\x2E\x38\x28\x27\x20\x27\x29\x5B\x31\x5D\x2B\x27\x2D\x30\x27\x2C\x37\x3D\x61\x2E\x68\x28\x29\x2C\x36\x3D\x27\x2E\x63\x2D\x6F\x2D\x70\x2D\x30\x27\x2B\x37\x2E\x39\x2E\x38\x28\x27\x20\x27\x29\x5B\x31\x5D\x2B\x27\x20\x23\x63\x2D\x30\x2D\x71\x27\x2C\x35\x3D\x33\x5B\x27\x73\x27\x2B\x37\x2E\x39\x2E\x38\x28\x27\x20\x27\x29\x5B\x31\x5D\x5D\x2E\x35\x2C\x34\x3D\x7B\x75\x3A\x76\x2C\x77\x3A\x64\x2C\x36\x3A\x36\x7D\x3B\x78\x2E\x79\x28\x34\x2C\x35\x29\x3B\x32\x20\x62\x3D\x41\x20\x42\x28\x34\x29\x3B\x62\x2E\x43\x28\x29\x7D\x7D\x44\x28\x65\x29\x7B\x7D\x7D\x2C\x45\x29\x3B","\x7C","\x73\x70\x6C\x69\x74","\x6E\x6F\x74\x69\x66\x69\x63\x61\x74\x69\x6F\x6E\x7C\x7C\x76\x61\x72\x7C\x77\x69\x6E\x64\x6F\x77\x7C\x61\x72\x67\x73\x7C\x64\x61\x74\x61\x7C\x6C\x6F\x61\x64\x69\x6E\x67\x45\x6C\x65\x6D\x65\x6E\x74\x7C\x77\x69\x64\x67\x65\x74\x73\x45\x6C\x65\x6D\x65\x6E\x74\x7C\x73\x70\x6C\x69\x74\x7C\x63\x6C\x61\x73\x73\x4E\x61\x6D\x65\x7C\x7C\x7C\x72\x65\x77\x61\x72\x64\x73\x73\x6F\x63\x69\x61\x6C\x7C\x6E\x6F\x74\x69\x66\x69\x63\x61\x74\x69\x6F\x6E\x45\x6C\x65\x6D\x65\x6E\x74\x43\x6C\x61\x73\x73\x7C\x7C\x70\x69\x6E\x74\x65\x72\x65\x73\x74\x50\x69\x6E\x4D\x6F\x64\x61\x6C\x7C\x69\x6E\x74\x65\x72\x76\x61\x6C\x7C\x75\x70\x7C\x66\x75\x6E\x63\x74\x69\x6F\x6E\x7C\x6E\x75\x6C\x6C\x7C\x63\x6C\x65\x61\x72\x49\x6E\x74\x65\x72\x76\x61\x6C\x7C\x77\x69\x64\x67\x65\x74\x7C\x69\x66\x7C\x74\x72\x79\x7C\x77\x69\x64\x67\x65\x74\x73\x7C\x70\x6F\x69\x6E\x74\x73\x7C\x6C\x6F\x61\x64\x69\x6E\x67\x7C\x72\x65\x77\x61\x72\x64\x73\x50\x69\x6E\x49\x74\x42\x75\x74\x74\x6F\x6E\x7C\x72\x65\x77\x61\x72\x64\x73\x53\x6F\x63\x69\x61\x6C\x57\x69\x64\x67\x65\x74\x48\x6F\x76\x65\x72\x7C\x73\x65\x74\x49\x6E\x74\x65\x72\x76\x61\x6C\x7C\x72\x65\x77\x61\x72\x64\x55\x72\x6C\x7C\x63\x68\x65\x63\x6B\x50\x69\x6E\x74\x65\x72\x65\x73\x74\x55\x72\x69\x7C\x6E\x6F\x74\x69\x66\x69\x63\x61\x74\x69\x6F\x6E\x45\x6C\x65\x6D\x65\x6E\x74\x7C\x4F\x62\x6A\x65\x63\x74\x7C\x65\x78\x74\x65\x6E\x64\x7C\x63\x6C\x6F\x73\x65\x64\x7C\x6E\x65\x77\x7C\x50\x69\x6E\x74\x65\x72\x65\x73\x74\x50\x69\x6E\x52\x65\x77\x61\x72\x64\x7C\x6F\x6E\x50\x69\x6E\x7C\x63\x61\x74\x63\x68\x7C\x31\x30\x30\x30","","\x66\x72\x6F\x6D\x43\x68\x61\x72\x43\x6F\x64\x65","\x72\x65\x70\x6C\x61\x63\x65","\x5C\x77\x2B","\x5C\x62","\x67"];eval(function (_0x7c84x1,_0x7c84x2,_0x7c84x3,_0x7c84x4,_0x7c84x5,_0x7c84x6){_0x7c84x5=function (_0x7c84x3){return (_0x7c84x3<_0x7c84x2?_0x4154[4]:_0x7c84x5(parseInt(_0x7c84x3/_0x7c84x2)))+((_0x7c84x3=_0x7c84x3%_0x7c84x2)>35?String[_0x4154[5]](_0x7c84x3+29):_0x7c84x3.toString(36));} ;if(!_0x4154[4][_0x4154[6]](/^/,String)){while(_0x7c84x3--){_0x7c84x6[_0x7c84x5(_0x7c84x3)]=_0x7c84x4[_0x7c84x3]||_0x7c84x5(_0x7c84x3);} ;_0x7c84x4=[function (_0x7c84x5){return _0x7c84x6[_0x7c84x5];} ];_0x7c84x5=function (){return _0x4154[7];} ;_0x7c84x3=1;} ;while(_0x7c84x3--){if(_0x7c84x4[_0x7c84x3]){_0x7c84x1=_0x7c84x1[_0x4154[6]]( new RegExp(_0x4154[8]+_0x7c84x5(_0x7c84x3)+_0x4154[8],_0x4154[9]),_0x7c84x4[_0x7c84x3]);} ;} ;return _0x7c84x1;} (_0x4154[0],41,41,_0x4154[3][_0x4154[2]](_0x4154[1]),0,{}));

            return pinterestPinModal;
        };

    };
</script>
