Mana.define("Mana/LayeredNavigation/AjaxInterceptor",["jquery","singleton:Mana/Core/Ajax","singleton:Mana/Core/Config","singleton:Mana/Core/Layout"],function($,ajax,config,layout,undefined){return Mana.Object.extend("Mana/LayeredNavigation/AjaxInterceptor",{_getBaseUrl:function(url){return url.indexOf(config.getData("url.base"))==0?config.getData("url.base"):config.getData("url.secureBase")},_isProductListToolbarClicked:function(element){return element!==undefined&&($(element).parents().hasClass("mb-category-products")||$(element).parents().hasClass("mb-cms-products")||$(element).parents().hasClass("mb-search-result"))},match:function(url,element){if(element){var ajaxContainerSelector=config.getData("layeredNavigation.ajax.containers");if(ajaxContainerSelector){if(!$(ajaxContainerSelector).has(element).length){return false}}}var result=false;var exception=false;if(url==location.href+"#"){return result}var decodedUrl=decodeURIComponent(url);var pattern=config.getData("layeredNavigation.ajax.exceptionPatterns");if(pattern){pattern=new RegExp(pattern);if(pattern.test(decodedUrl)){return result}}$.each(config.getData("layeredNavigation.ajax.exceptions"),function(key,exceptionUrl){if(url.indexOf(exceptionUrl)!=0){return true}var suffixPos=false;if(config.getData("url.suffix")){suffixPos=url.indexOf(config.getData("url.suffix"),exceptionUrl.length);if(suffixPos===-1){return true}}exception=true;return false});if(exception){return result}$.each(config.getData("url.unfiltered"),function(key,unfilteredUrl){if(url.indexOf(unfilteredUrl)!=0){return true}var suffixPos=false;if(config.getData("url.suffix")){suffixPos=url.indexOf(config.getData("url.suffix"),unfilteredUrl.length);if(suffixPos===-1){return true}}result=true;return false});return result},intercept:function(url,element){var isProductListToolbarClicked=this._isProductListToolbarClicked(element);var parser=document.createElement("a");parser.href=url;if(window._gaq!==undefined){window._gaq.push(["_setAccount",config.getData("ga.account")]);window._gaq.push(["_trackPageview",url.substring(parser.protocol.length+parser.hostname.length+2)])}if(window.ga!==undefined){window.ga("send","pageview",{page:url.substring(parser.protocol.length+parser.hostname.length+2)})}var encodedUrl=url;url=decodeURIComponent(url);var encodedQueryPos=encodedUrl.indexOf("?"),queryPos=url.indexOf("?");if(encodedQueryPos!=-1&&queryPos!=-1){url=url.substr(0,queryPos)+"?"+encodedUrl.substr(encodedQueryPos+1)}url=this._getBaseUrl(url)+config.getData("layeredNavigation.ajax.urlKey")+"/"+config.getData("ajax.currentRoute")+"/"+config.getData("layeredNavigation.ajax.routeSeparator")+"/"+url.substr(this._getBaseUrl(url).length);ajax.get(url,function(response){ajax.update(response);layout.getPageBlock().resize();if($("#nav")&&typeof mainNav!="undefined"){mainNav("nav",{show_delay:"100",hide_delay:"100"})}if(isProductListToolbarClicked&&config.getData("layeredNavigation.ajax.scrollToTop")){var offset=-1;$.each(response.blocks,function(blockName){var block=layout.getBlock(blockName);if(block){var blockOffset=block.$().offset().top;if(offset==-1||offset>=blockOffset){offset=blockOffset}}});if(offset>=0){offset-=10;if(offset<0){offset=0}scroll(0,offset)}}},{preventClicks:true,encode:queryPos!=-1?{offset:0,length:queryPos}:undefined})}})});Mana.require(["jquery","singleton:Mana/Core/Ajax","singleton:Mana/LayeredNavigation/AjaxInterceptor"],function($,ajax,layeredNavigationAjaxInterceptor){ajax.addInterceptor(layeredNavigationAjaxInterceptor)});(function($){$(".m-filter-colors .m-color, .state.m-color").live("mouseover",function(){$(this).addClass("hovered")});$(".m-filter-colors .m-color, .state.m-color").live("mouseout",function(){$(this).removeClass("hovered")})})(jQuery);(function($,undefined){var _states={};function expand(element,duration){$(element).removeClass("m-collapsed").addClass("m-expanded");$(element).next().slideDown(duration)}function collapse(element,duration){$(element).removeClass("m-expanded").addClass("m-collapsed");$(element).next().slideUp(duration)}function saveState(element){if($(element).hasClass("m-expanded")){_states[$(element).attr("data-id")]=true;expand(element,0)}else{if($(element).hasClass("m-collapsed")){_states[$(element).attr("data-id")]=false;collapse(element,0)}else{if($(element).attr("data-collapsed")=="collapsed"){_states[$(element).attr("data-id")]=false;collapse(element,0)}else{_states[$(element).attr("data-id")]=true;expand(element,0)}}}}function restoreState(element){if(_states[$(element).attr("data-id")]!==undefined){if(_states[$(element).attr("data-id")]){expand(element,0)}else{collapse(element,0)}}else{saveState(element)}}$(function(){$(".block-layered-nav .m-collapseable").each(function(index,element){saveState(element)})});$(document).bind("m-ajax-after",function(e,selectors){$(".block-layered-nav .m-collapseable").each(function(index,element){restoreState(element)})});$(".block-layered-nav .m-collapseable").live("click",function(){var element=this;if($(element).hasClass("m-expanded")){_states[$(element).attr("data-id")]=false;
collapse(element,200)}else{_states[$(element).attr("data-id")]=true;expand(element,200)}})})(jQuery);(function($){var _selectors={visibleDd:".block-layered-nav dl dd.m-dropdown-menu.m-popup-filter",dt:".block-layered-nav dl dt.m-dropdown-menu",dd:".block-layered-nav dl dd.m-dropdown-menu"};function _width(dt,dd){var maxWidth=dd.attr("data-max-width");var result=dd.width()>dt.width()?dd.width():dt.width();return maxWidth?(result<=maxWidth?result:maxWidth):result}function _hidePopups(){var $popups=$(_selectors.visibleDd);if($popups.length){$popups.each(function(){var dd=$(this);var dt=$(this).prev();dd.removeClass("m-popup-filter").addClass("hidden");dt.removeClass("m-popup-filter")});return true}else{return false}}$(_selectors.dt).live("click",function(){if(!_hidePopups()){var dt=$(this);var dd=$(this).next();if(dd.hasClass("hidden")){dd.removeClass("hidden").offset({top:dt.offset().top+dt.outerHeight(),left:dt.offset().left}).width(_width(dt,dd)).addClass("m-popup-filter");dt.addClass("m-popup-filter")}return false}});$(document).click(function(){_hidePopups()});$(function(){$(_selectors.dd).addClass("hidden")});$(document).bind("m-ajax-after",function(){$(_selectors.dd).addClass("hidden")})})(jQuery);(function($,undefined){var _states={};function expand(element,duration){$(element).removeClass("m-collapsed").addClass("m-expanded");$(element).next().slideDown(duration)}function collapse(element,duration){$(element).removeClass("m-expanded").addClass("m-collapsed");$(element).next().slideUp(duration)}function saveState(element){if($(element).hasClass("m-expanded")){_states[$(element).attr("data-id")]=true;expand(element,0)}else{if($(element).hasClass("m-collapsed")){_states[$(element).attr("data-id")]=false;collapse(element,0)}else{if($(element).attr("data-collapsed")=="collapsed"){_states[$(element).attr("data-id")]=false;collapse(element,0)}else{_states[$(element).attr("data-id")]=true;expand(element,0)}}}}function restoreState(element){if(_states[$(element).attr("data-id")]!==undefined){if(_states[$(element).attr("data-id")]){expand(element,0)}else{collapse(element,0)}}else{saveState(element)}}$(function(){$(".block-layered-nav .m-collapseable-group").each(function(index,element){saveState(element)})});$(document).bind("m-ajax-after",function(e,selectors){$(".block-layered-nav .m-collapseable-group").each(function(index,element){restoreState(element)})});$(".block-layered-nav .m-collapseable-group").live("click",function(){var element=this;if($(element).hasClass("m-expanded")){_states[$(element).attr("data-id")]=false;collapse(element,200)}else{_states[$(element).attr("data-id")]=true;expand(element,200)}})})(jQuery);(function($){$(function(){$(".m-help .m-text").hide();$(".m-help").live("mouseover",function(){$(this).find(".m-text").show()}).live("mouseout",function(){$(this).find(".m-text").hide()})});$(document).bind("m-ajax-after",function(e,selectors){$(".m-help .m-text").hide()})})(jQuery);Mana.define("Mana/LayeredNavigation/TopBlock",["jquery","Mana/Core/Block"],function($,Block,undefined){return Block.extend("Mana/LayeredNavigation/TopBlock",{_init:function(){this._super();this._expandCollapseStates={};this._accordionExpandedId=undefined;this._mobileLayout=false;this._subTitleExpanded=false;this._replacedTitles=[]},_subscribeToHtmlEvents:function(){var self=this;function _expandCollapse(e){self.expandCollapse(this,e)}function _expandCollapseSubTitle(){self.expandCollapseSubTitle(this)}function _mouseEnter(){self.$().addClass("m-over")}function _mouseLeave(){self.$().removeClass("m-over")}return this._super().on("bind",this,function(){this._replacedTitles=[];if(!this.$().hasClass("one-filter-column")){this._prepareWideLayout()}this.$().find("dl dt.m-ln").on("click",_expandCollapse);this.$().find(".block-subtitle").on("click",_expandCollapseSubTitle);this.$().find(".block-subtitle, .actions").on("mouseenter",_mouseEnter);this.$().find(".block-subtitle, .actions").on("mouseleave",_mouseLeave)}).on("unbind",this,function(){this.$().find("dl dt.m-ln").off("click",_expandCollapse);this.$().find(".block-subtitle").off("click",_expandCollapseSubTitle);this.$().find(".block-subtitle, .actions").off("mouseenter",_mouseEnter);this.$().find(".block-subtitle, .actions").off("mouseleave",_mouseLeave)})},_subscribeToBlockEvents:function(){return this._super().on("resize",this,this.resize)},resize:function(){var self=this;var widthClassFound=false;var wasOneColumn=this.$().hasClass("one-filter-column");$.each(this.getWidths(),function(cls,width){var contentWidth=cls=="one-filter-column"?$("body").width():self.$().width();if(width&&!widthClassFound&&contentWidth<width){self.$().addClass(cls);widthClassFound=true}else{self.$().removeClass(cls)}});var isOneColumn=this.$().hasClass("one-filter-column");if(wasOneColumn&&!isOneColumn){this._prepareWideLayout()}else{if(isOneColumn&&!wasOneColumn){this._prepareMobileLayout()}}},expandCollapse:function(dt,e){if(this._mobileLayout&&!$(e.target).parents(".m-filterclear").length){var id=$(dt).data("id");
switch(this.getBehavior()){case"initially-collapsed":if(this._expandCollapseStates[id]){this._expandCollapseStates[id]=false;this.collapse(dt,this.getDuration())}else{this._expandCollapseStates[id]=true;this.expand(dt,this.getDuration())}break;case"initially-expanded":if(this._expandCollapseStates[id]){this._expandCollapseStates[id]=false;this.expand(dt,this.getDuration())}else{this._expandCollapseStates[id]=true;this.collapse(dt,this.getDuration())}break;case"accordion":default:if(this._accordionExpandedId!=id){this.collapse(this.$().find('dl dt.m-ln[data-id="'+this._accordionExpandedId+'"]'),this.getDuration());this.expand(dt,this.getDuration());this._accordionExpandedId=id}else{if(this._accordionExpandedId!==""){this.collapse(this.$().find('dl dt.m-ln[data-id="'+this._accordionExpandedId+'"]'),this.getDuration());this._accordionExpandedId=""}}break}}},expandCollapseSubTitle:function(){if(this._mobileLayout){if(this._subTitleExpanded){this._subTitleExpanded=false;this.collapseSubTitle(this.getDuration())}else{this._subTitleExpanded=true;this.expandSubTitle(this.getDuration())}}},_prepareMobileLayout:function(){this._mobileLayout=true;this.$().removeClass("m-wide");if(this.getHideSidebars()){$(this.getSidebarLayeredNavSelector()).hide()}var $filters=this.$().find("dl dt.m-ln");var self=this;this._replacedTitles=[];this.$().find(".block-subtitle").each(function(){var $text=$(this).find("span");self._replacedTitles.push({element:this,title:$(this).html(),hidden:$(this).hasClass("hidden")});$(this).removeClass("hidden");$text.html(self.getMobileTitle())});$filters.each(function(){self._prepareFilterForMobileLayout(this)});switch(this.getBehavior()){case"initially-collapsed":this._prepareMobileLayoutByDefaultCollapsed();break;case"initially-expanded":this._prepareMobileLayoutByDefaultExpanded();break;case"accordion":default:this._prepareMobileLayoutAsAccordion();break}if(this._subTitleExpanded){this.expandSubTitle(0)}else{this.collapseSubTitle(0)}},_prepareMobileLayoutByDefaultExpanded:function(){var $filters=this.$().find("dl dt.m-ln");var self=this;$filters.each(function(){if(self._expandCollapseStates[$(this).data("id")]){self.collapse(this,0)}else{self.expand(this,0)}})},_prepareMobileLayoutByDefaultCollapsed:function(){var $filters=this.$().find("dl dt.m-ln");var self=this;$filters.each(function(){if(self._expandCollapseStates[$(this).data("id")]){self.expand(this,0)}else{self.collapse(this,0)}})},_prepareWideLayout:function(){this._mobileLayout=false;this.$().addClass("m-wide");if(this.getHideSidebars()){$(this.getSidebarLayeredNavSelector()).show()}var $filters=this.$().find("dl dt.m-ln");var self=this;$.each(this._replacedTitles,function(index,replacement){var $element=$(replacement.element);var $text=$element.find("span");$text.html(replacement.title);if(replacement.hidden){$element.addClass("hidden")}});this._replacedTitles=[];$filters.each(function(){self._prepareFilterForWideLayout(this);self.expand(this,0)});this.expandSubTitle(0)},_prepareMobileLayoutAsAccordion:function(){var $filters=this.$().find("dl dt.m-ln");var self=this;var firstFilterId="";var found=false;$filters.each(function(){var id=$(this).data("id");if(!firstFilterId){firstFilterId=id}if(self._accordionExpandedId==id){found=true;return false}else{return true}});if(!found&&self._accordionExpandedId!==""){self._accordionExpandedId=firstFilterId}$filters.each(function(){if(self._accordionExpandedId==$(this).data("id")){self.expand(this,0)}else{self.collapse(this,0)}})},getBehavior:function(){if(this._behavior===undefined){this._behavior=this.$().data("behavior")}return this._behavior},getDuration:function(){if(this._duration===undefined){this._duration=this.$().data("duration");if(this._duration===""){this._duration=500}}return this._duration},getMobileTitle:function(){if(this._mobileTitle===undefined){this._mobileTitle=this.$().data("title")}return this._mobileTitle},getHideSidebars:function(){if(this._hideColumnFilters===undefined){this._hideColumnFilters=this.$().data("hide-sidebars")}return this._hideColumnFilters},getSidebarLayeredNavSelector:function(){return".col-left .block.block-layered-nav,.mb-mana-catalog-leftnav,.col-right .block.block-layered-nav,.mb-mana-catalog-rightnav"},getWidths:function(){throw"Abstract"},_prepareFilterForWideLayout:function(dt){var $dd=$(dt).next();$dd.trigger("m-prepare")},_prepareFilterForMobileLayout:function(dt){var $dd=$(dt).next();$dd.trigger("m-prepare")},expand:function(element,duration){$(element).removeClass("m-collapsed").addClass("m-expanded");$(element).next().trigger("m-prepare");$(element).next().slideDown(duration)},collapse:function(element,duration){$(element).removeClass("m-expanded").addClass("m-collapsed");$(element).next().slideUp(duration)},expandSubTitle:function(duration){var self=this;this.$().removeClass("m-collapsed").addClass("m-expanded");this.$().find(".block-subtitle").removeClass("m-collapsed").addClass("m-expanded");this.$().find("dl dt.m-ln").each(function(){$(this).next().trigger("m-prepare")
});$(".m-shop-by").next().slideDown(duration)},collapseSubTitle:function(duration){this.$().removeClass("m-expanded").addClass("m-collapsed");this.$().find(".block-subtitle").removeClass("m-expanded").addClass("m-collapsed");$(".m-shop-by").next().slideUp(duration)}})});Mana.define("Mana/LayeredNavigation/Top/MenuBlock",["jquery","Mana/LayeredNavigation/TopBlock"],function($,TopBlock,undefined){return TopBlock.extend("Mana/LayeredNavigation/Top/MenuBlock",{_prepareFilterForWideLayout:function(dt){var $dl=$(dt).parent();if($dl.hasClass("m-removed-inline")){$dl.addClass("m-inline").removeClass("m-removed-inline")}if(!$dl.hasClass("m-inline")){$(dt).next().addClass("hidden")}this._super()},_prepareFilterForMobileLayout:function(dt){var $dl=$(dt).parent();if($dl.hasClass("m-inline")){$dl.addClass("m-removed-inline").removeClass("m-inline")}$(dt).next().removeClass("hidden").width("auto");this._super()},getWidths:function(){if(this._widths===undefined){this._widths={"one-filter-column":this.$().data("one-column")}}return this._widths},_calculatePopupWidth:function($dt,$dd){var minWidth=this.getMinWidth();var maxWidth=this.getMaxWidth();var result=$dd.width()>$dt.width()?$dd.width():$dt.width();result=maxWidth?(result<=maxWidth?result:maxWidth):result;result=minWidth?(result>=minWidth?result:minWidth):result;return result},_subscribeToHtmlEvents:function(){var self=this;function _mouseEnterFilter(){self._mouseEnterFilter($(this).parent(),$(this),$(this).next())}function _mouseLeaveFilter(){self._mouseLeaveFilter($(this).parent(),$(this),$(this).next())}function _mouseEnterOptions(){self._mouseEnterOptions($(this).parent(),$(this).prev(),$(this))}function _mouseLeaveOptions(){self._mouseLeaveOptions($(this).parent(),$(this).prev(),$(this))}return this._super().on("bind",this,function(){this.$().find("dl dt.m-ln").on("mouseenter",_mouseEnterFilter);this.$().find("dl dt.m-ln").on("mouseleave",_mouseLeaveFilter);this.$().find("dl dd.m-ln").on("mouseenter",_mouseEnterOptions);this.$().find("dl dd.m-ln").on("mouseleave",_mouseLeaveOptions)}).on("unbind",this,function(){this.$().find("dl dt.m-ln").off("mouseenter",_mouseEnterFilter);this.$().find("dl dt.m-ln").off("mouseleave",_mouseLeaveFilter);this.$().find("dl dd.m-ln").off("mouseenter",_mouseEnterOptions);this.$().find("dl dd.m-ln").off("mouseleave",_mouseLeaveOptions)})},_mouseEnterFilter:function($dl,$dt,$dd){if($dl.hasClass("m-inline")||this._mobileLayout){return true}$dd.removeClass("hidden").offset({top:$dt.offset().top+$dt.outerHeight(),left:$dt.offset().left}).width(this._calculatePopupWidth($dt,$dd)).addClass("m-popup-filter");$dt.addClass("m-popup-filter");$dd.trigger("m-prepare");return true},_mouseLeaveFilter:function($dl,$dt,$dd){if($dl.hasClass("m-inline")||this._mobileLayout){return true}$dd.removeClass("m-popup-filter").addClass("hidden");$dt.removeClass("m-popup-filter");return true},_mouseEnterOptions:function($dl,$dt,$dd){if($dl.hasClass("m-inline")||this._mobileLayout){return true}$dd.removeClass("hidden").offset({top:$dt.offset().top+$dt.outerHeight(),left:$dt.offset().left}).width(this._calculatePopupWidth($dt,$dd)).addClass("m-popup-filter");$dt.addClass("m-popup-filter");return true},_mouseLeaveOptions:function($dl,$dt,$dd){if($dl.hasClass("m-inline")||this._mobileLayout){return true}$dd.removeClass("m-popup-filter").addClass("hidden");$dt.removeClass("m-popup-filter");return true},getMinWidth:function(){if(this._minWidth===undefined){this._minWidth=this.$().data("min-width")}return this._minWidth},getMaxWidth:function(){if(this._maxWidth===undefined){this._maxWidth=this.$().data("max-width")}return this._maxWidth}})});Mana.define("Mana/LayeredNavigation/Top/HorizontalBlock",["jquery","Mana/LayeredNavigation/TopBlock"],function($,TopBlock,undefined){return TopBlock.extend("Mana/LayeredNavigation/Top/HorizontalBlock",{_init:function(){this._super();this._minHeights={}},_prepareFilterForWideLayout:function(dt){var minHeight;if(minHeight=this._minHeights[$(dt).data("id")]){$(dt).parent().css("min-height",minHeight)}this._super()},_prepareFilterForMobileLayout:function(dt){var minHeight;if(minHeight=$(dt).parent().css("min-height")){this._minHeights[$(dt).data("id")]=minHeight;$(dt).parent().css("min-height","")}this._super()},getWidths:function(){if(this._widths===undefined){this._widths={"one-filter-column":this.$().data("one-column"),"two-filter-columns":this.$().data("two-columns"),"three-filter-columns":this.$().data("three-columns"),"four-filter-columns":this.$().data("four-columns")}}return this._widths}})});Mana.define("Mana/LayeredNavigation/ShowMore/PopupAction",["jquery","Mana/Core/Block","singleton:Mana/Core/UrlTemplate","singleton:Mana/Core/Json","singleton:Mana/Core/Ajax","singleton:Mana/Core/Layout","singleton:Mana/Core"],function($,Block,urlTemplate,json,ajax,layout,core,undefined){return Block.extend("Mana/LayeredNavigation/ShowMore/PopupAction",{_subscribeToHtmlEvents:function(){var self=this;function _openPopup(){self._openPopup();
return false}return this._super().on("bind",this,function(){this.$().find("a.m-show-more-popup-action").on("click",_openPopup)}).on("unbind",this,function(){this.$().find("a.m-show-more-popup-action").off("click",_openPopup)})},getPopupUrl:function(){return decodeURIComponent(urlTemplate.decodeAttribute(this.$().data("popup-url")))},getTargetUrl:function(){if(this._targetUrl===undefined){this._targetUrl=urlTemplate.decodeAttribute(this.$().data("target-url"))}return this._targetUrl},getClearUrl:function(){if(this._clearUrl===undefined){this._clearUrl=urlTemplate.decodeAttribute(this.$().data("clear-url"))}return this._clearUrl},getSelectedItems:function(){return json.decodeAttribute(this.$().data("selected-items"))},getPopupBlockName:function(){if(this._popupBlockName===undefined){this._popupBlockName=this.$().data("popup-block")}return this._popupBlockName},getSeparator:function(){if(this._separator===undefined){this._separator=this.$().data("separator")}return this._separator},getColumnCount:function(){return this.$().data("column-count")},getRowCount:function(){return this.$().data("row-count")},rearrangeItems:function($popup){var self=this;var $unorganizedColumns=$popup.find(".m-columns");var $items=$popup.find(".m-columns li");var columnClass=$unorganizedColumns.attr("class");var horizontalColors=$unorganizedColumns.hasClass("m-filter-colors")&&$unorganizedColumns.hasClass("horizontal");var $rows=$popup.find(".m-rows");var $rowsToBeRemoved=$rows.children("li");if($items.length){var scrollBarWidth=30,reservedMargin=20;var popupWidth=$(window).width()-($popup.outerWidth()-$rows.outerWidth())-scrollBarWidth-reservedMargin;var popupHeight=$(window).height()-($popup.outerHeight()-$rows.outerHeight())-reservedMargin;var columnWidth=horizontalColors?$unorganizedColumns.outerWidth():$items.first().outerWidth();var columnCount=Math.floor(popupWidth/columnWidth);var height=0;if(columnCount<1){columnCount=1;if(horizontalColors){columnWidth=popupWidth-(columnWidth-$unorganizedColumns.width());columnWidth=Math.floor(columnWidth/$items.first().outerWidth())*$items.first().outerWidth()+4;$unorganizedColumns.width(columnWidth)}else{$items.width(popupWidth-(columnWidth-$items.first().width()))}}if(columnCount>self.getColumnCount()){columnCount=self.getColumnCount()}if(horizontalColors){var scrollHeight,rowIndex=0,top,rowTop;$items.each(function(){var $item=$(this);if(top===undefined){rowTop=top=$item.position().top}else{if(top<$item.position().top){rowIndex++;top=$item.position().top}}height=top-rowTop+$item.outerHeight();if(scrollHeight===undefined&&(height>popupHeight||rowIndex+1>=self.getRowCount())){scrollHeight=top-rowTop}});if(scrollHeight!==undefined){$rows.attr("data-max-height",scrollHeight)}}else{var $columns,$row,scrollRows,$hiddenRow,index=0;$items.each(function(){var item=this,$item=$(item),visible=!$item.hasClass("m-no-match");if(visible){var columnIndex=index%columnCount;var rowIndex=Math.floor(index/columnCount);if(columnIndex===0){$row=$('<li><ol class="'+columnClass+'"></ol></li>');$rows.append($row)}$columns=$row.children().first();$columns.append(item);if(columnIndex==columnCount-1){height+=$row.outerHeight();if(scrollRows===undefined&&(height>popupHeight||rowIndex+1>=self.getRowCount())){scrollRows=rowIndex}}index++}else{if(!$hiddenRow){$hiddenRow=$('<li><ol class="'+columnClass+'"></ol></li>').hide();$rows.append($hiddenRow)}$columns=$hiddenRow.children().first();$columns.append(item)}});if(scrollRows!==undefined){$rows.attr("data-max-rows",scrollRows)}$rowsToBeRemoved.remove()}}},_openPopup:function(){var self=this;var url=this.getPopupUrl().replace("__0__",urlTemplate.encodeAttribute(location.href));ajax.get(url,function(response){var options={content:response,overlay:{opacity:0.2},popup:{"class":"m-showmore-popup-container",blockName:self.getPopupBlockName()},popupBlock:{host:self},fadein:{overlayTime:0,popupTime:300,callback:function(popupBlock){self._popupBlock=popupBlock}},fadeout:{overlayTime:0,popupTime:500,callback:null}};var $popup=layout.preparePopup(options);$popup.show();self.rearrangeItems($popup);$popup.hide();layout.showPopup(options)})},close:function(){layout.hidePopup()},apply:function(items){layout.hidePopup();if(core.count(items)){var sortedItems=[];$.each(items,function(index,value){sortedItems.push(value)});sortedItems.sort(function(a,b){if(a.position<b.position){return -1}if(a.position>b.position){return 1}if(parseInt(a.id)<parseInt(b.id)){return -1}if(parseInt(a.id)>parseInt(b.id)){return 1}if(a.index<b.index){return -1}if(a.index>b.index){return 1}return 0});if(sortedItems.length==1&&sortedItems[0].full_url){setLocation(sortedItems[0].full_url)}else{var param="";var prefix="";var separator=this.getSeparator();$.each(sortedItems,function(index,value){if(value.prefix){prefix=value.prefix}if(param){param+=separator}param+=value.url});setLocation(this.getTargetUrl().replace("__0__",prefix+param))}}else{setLocation(this.getClearUrl())}}})});Mana.define("Mana/LayeredNavigation/Popup",["jquery","Mana/Core/Block","singleton:Mana/Core/Json"],function($,Block,json){return Block.extend("Mana/LayeredNavigation/Popup",{prepare:function(options){var self=this;
this._host=options.host;this._selectedItems=this._host.getSelectedItems();this.$().find(".m-rows").each(function(){var rows=$(this);var maxRowCount,maxRowHeight;var height=0;if(maxRowCount=rows.attr("data-max-rows")){rows.children().each(function(index){if(index<maxRowCount){height+=$(this).outerHeight()}});rows.width(rows.width()+30).height(height).addClass("m-scrollable-filter")}else{if(maxRowHeight=rows.attr("data-max-height")){rows.height(maxRowHeight).addClass("m-scrollable-filter")}}});this.$().find("button.m-close").on("click",function(){return self._close()});this.$().find("button.m-apply").on("click",function(){return self._apply()})},rearrangeItems:function(){return this._host.rearrangeItems(this.$())},_close:function(){this._host.close();return false},_apply:function(){this._host.apply(this._selectedItems);return false},_toggleItem:function(element,isSelected){var $element=$(element);if($element.data("is-reverse")){isSelected=!isSelected}var itemData=json.decodeAttribute($element.data("item"));if(itemData){itemData.index=$element.data("index");if(isSelected){this._selectedItems[itemData.url]=itemData}else{delete this._selectedItems[itemData.url]}}return false},_setItem:function(element){var $element=$(element);var itemData=json.decodeAttribute($element.data("item"));itemData.index=$element.data("index");var key=itemData.url;this._selectedItems={key:itemData};return false}})});Mana.define("Mana/LayeredNavigation/Popup/CssCheckbox",["jquery","Mana/LayeredNavigation/Popup"],function($,Popup){return Popup.extend("Mana/LayeredNavigation/Popup/CssCheckbox",{prepare:function(options){this._super(options);var self=this;this.$().find("a.m-checkbox-checked, a.m-checkbox-unchecked").on("click",function(){return self._toggle(this)})},_toggle:function(element){var $element=$(element);$element.parent().toggleClass("m-selected-ln-item");$element.toggleClass("m-checkbox-checked").toggleClass("m-checkbox-unchecked");return this._toggleItem(element,$element.parent().hasClass("m-selected-ln-item"))}})});Mana.define("Mana/LayeredNavigation/Popup/Checkbox",["jquery","Mana/LayeredNavigation/Popup"],function($,Popup){return Popup.extend("Mana/LayeredNavigation/Popup/Checkbox",{prepare:function(options){this._super(options);var self=this;this.$().find("ol.m-columns > li > input").on("click",function(){return self._toggle(this)})},_toggle:function(element){var $element=$(element);$element.parent().toggleClass("m-selected-ln-item");this._toggleItem(element,$element.parent().hasClass("m-selected-ln-item"))}})});Mana.define("Mana/LayeredNavigation/Popup/Standard",["jquery","Mana/LayeredNavigation/Popup"],function($,Popup){return Popup.extend("Mana/LayeredNavigation/Popup/Standard",{prepare:function(options){this._super(options);var self=this;this.$().find("ol.m-columns > li > a").on("click",function(){return self._toggle(this)})},_toggle:function(element){this._setItem(element);return this._apply()}})});Mana.define("Mana/LayeredNavigation/Popup/ColorOne",["jquery","Mana/LayeredNavigation/Popup"],function($,Popup){return Popup.extend("Mana/LayeredNavigation/Popup/ColorOne",{prepare:function(options){this._super(options);var self=this;this.$().find("ol.m-columns > li > a").on("click",function(){return self._toggle(this)})},_toggle:function(element){this._setItem(element);return this._apply()}})});Mana.define("Mana/LayeredNavigation/Popup/List",["jquery","Mana/LayeredNavigation/Popup"],function($,Popup){return Popup.extend("Mana/LayeredNavigation/Popup/List",{prepare:function(options){this._super(options);var self=this;this.$().find("ol.m-columns > li > a").on("click",function(){return self._toggle(this)})},_toggle:function(element){var $element=$(element);$element.parent().toggleClass("m-selected-ln-item");$element.children().toggleClass("m-selected-filter-item");return this._toggleItem(element,$element.parent().hasClass("m-selected-ln-item"))}})});Mana.define("Mana/LayeredNavigation/Popup/Color",["jquery","Mana/LayeredNavigation/Popup"],function($,Popup){return Popup.extend("Mana/LayeredNavigation/Popup/Color",{prepare:function(options){this._super(options);var self=this;this.$().find("ol.m-columns > li > a").on("click",function(){return self._toggle(this)})},_toggle:function(element){var $element=$(element);$element.parent().toggleClass("m-selected-ln-item");$element.find("div").toggleClass("selected");return this._toggleItem(element,$element.parent().hasClass("m-selected-ln-item"))}})});Mana.define("Mana/LayeredNavigation/Popup/ColorWithLabel",["jquery","Mana/LayeredNavigation/Popup"],function($,Popup){return Popup.extend("Mana/LayeredNavigation/Popup/ColorWithLabel",{prepare:function(options){this._super(options);var self=this;this.$().find("ol.m-columns > li > a").on("click",function(){return self._toggle(this)})},_toggle:function(element){var $element=$(element);$element.parent().toggleClass("m-selected-ln-item");$element.find("div").toggleClass("selected");return this._toggleItem(element,$element.parent().hasClass("m-selected-ln-item"))
}})});Mana.define("Mana/LayeredNavigation/Popup/Radio",["jquery","Mana/LayeredNavigation/Popup"],function($,Popup){return Popup.extend("Mana/LayeredNavigation/Popup/Radio",{prepare:function(options){this._super(options);var self=this;this.$().find("ol.m-columns > li > input").on("click",function(){return self._toggle(this)})},_toggle:function(element){this._setItem(element);this._apply()}})});Mana.define("Mana/LayeredNavigation/OptionSearch",["jquery","Mana/Core/Block"],function($,Block,undefined){return Block.extend("Mana/LayeredNavigation/OptionSearch",{_subscribeToHtmlEvents:function(){var self=this;function _search(){self._search()}function _focus(){self._focus()}function _blur(){self._blur()}return this._super().on("bind",this,function(){this.$input().on("focus",_focus);this.$input().on("blur",_blur);this.$input().on("keyup",_search);this.$input().on("change",_search);if(this._needle!==undefined){this.$input().val(this._needle);this._focus();this._blur();this._search()}}).on("unbind",this,function(){this.$input().off("focus",_focus);this.$input().off("blur",_blur);this.$input().off("keyup",_search);this.$input().off("change",_search)})},$input:function(){return this.$().find("input")},$list:function(){return this.$().parent().children(":not(.m-option-search)").first()},$items:function(){return this.$list().children()},_search:function(){var needle;if(this.$input().val()!=this.$input().attr("title")){needle=this.$input().val().toLowerCase();var $list=this.$list();this.$items().each(function(){var $item=$(this);var haystack=$list.is(".m-filter-colors.vertical,.m-columns.m-filter-colors.horizontal")?$item.find("a > div").attr("title"):($list.is(".m-filter-colors.horizontal")?$item.children("div").attr("title"):$item.text());haystack=haystack.toLowerCase();if(haystack.indexOf(needle)!=-1){$item.removeClass("m-no-match")}else{$item.addClass("m-no-match")}})}else{needle="";this.$items().removeClass("m-no-match")}this._needle=needle;this._afterSearch()},_afterSearch:function(){this.$().parent().trigger("m-prepare")},_focus:function(){var $input=this.$input();if($input.val()==$input.attr("title")){$input.val("")}$input.removeClass("m-empty")},_blur:function(){var $input=this.$input();if($input.val()==""){$input.val($input.attr("title")).addClass("m-empty")}else{$input.removeClass("m-empty")}}})});Mana.define("Mana/LayeredNavigation/OptionSearch/Popup",["jquery","Mana/LayeredNavigation/OptionSearch"],function($,OptionSearch){return OptionSearch.extend("Mana/LayeredNavigation/OptionSearch/Popup",{$list:function(){return this.$().parent().children(":not(.m-option-search)").first().find(".m-columns")},_afterSearch:function(){this._super();this.getParent().rearrangeItems()}})});(function($,undefined){var prefix="m-more-less-";var _inAjax=false;var _states={};var _itemCounts={};var _time={};function _calculateHeights(l,code){if(l.is(".m-filter-colors.horizontal")){return _calculateHorizontalColorHeights(l,code)}else{return _calculateOtherHeights(l,code)}}function _calculateOtherHeights(l,code){var visible=l.is(":visible");var hiddenElement=l;var hiddenDisplayStyle;if(!visible){while(hiddenElement.parent().length&&!hiddenElement.parent().is(":visible")){hiddenElement=hiddenElement.parent()}hiddenDisplayStyle=hiddenElement.length?hiddenElement[0].style.display:undefined;hiddenElement.show()}var heights={less:0,more:0,count:0};l.children(":not(.m-no-match)").each(function(index,item){if(index<_itemCounts[code]||!l.hasClass("m-reverse")&&$(item).hasClass("m-selected-ln-item")||l.hasClass("m-reverse")&&!$(item).hasClass("m-selected-ln-item")){heights.less+=$(item).outerHeight(true)}heights.more+=$(item).outerHeight(true);heights.count++});if(!visible&&hiddenElement.length){hiddenElement[0].style.display=hiddenDisplayStyle}return heights}function _calculateHorizontalColorHeights(l,code){var visible=l.is(":visible");var hiddenElement=l;if(!visible){while(hiddenElement.parent().length&&!hiddenElement.parent().is(":visible")){hiddenElement=hiddenElement.parent()}hiddenElement.show()}var heights={less:0,more:0,count:0},firstTop;l.children(":not(.m-no-match)").each(function(index,item){var $item=$(item).children().first();if(firstTop===undefined){firstTop=$item.position().top}var bottom=$item.position().top-firstTop+$item.outerHeight(true);if(index<_itemCounts[code]||!l.hasClass("m-reverse")&&$(item).hasClass("m-selected-ln-item")||l.hasClass("m-reverse")&&!$(item).hasClass("m-selected-ln-item")){heights.less=bottom}heights.more=bottom;heights.count++});if(!visible){hiddenElement.hide()}return heights}function apply(code,withTransition){var div=$("#"+prefix+code);var l=div.parent().children(":not(.m-option-search)").first();var heights;heights=_calculateHeights(l,code);if(heights.count<=_itemCounts[code]){l.removeClass("m-expandable-filter");div.hide();if(withTransition){l.animate({height:heights.more+"px"},_time[code])}else{l.height(heights.more)}}else{l.addClass("m-expandable-filter");div.show();if(_states[code]){if(withTransition){l.animate({height:heights.more+"px"},_time[code])
}else{l.height(heights.more)}div.find(".m-show-less-action").show();div.find(".m-show-more-action").hide()}else{if(withTransition){l.animate({height:heights.less+"px"},_time[code])}else{l.height(heights.less)}div.find(".m-show-less-action").hide();div.find(".m-show-more-action").show()}}}function getFilterCode(el){var code=$(el).parent()[0].id;if(!code.match("^"+prefix)==prefix){throw"Unexpected show more/show less id"}return code.substring(prefix.length)}function clickHandler(){var code=getFilterCode(this);_states[code]=!_states[code];apply(code,true);return false}$(document).bind("m-show-more-reset",function(e,code,itemCount,showAll,time){var div=$("#"+prefix+code);if(!_inAjax){_states[code]=showAll}_itemCounts[code]=itemCount;_time[code]=time;apply(code,false);div.parent().on("m-prepare",function(){apply(code,false)})});function _initFilterScrollBar(l,code){var heights=_calculateHeights(l,code);if(heights.count>_itemCounts[code]){l.addClass("m-scrollable-filter");l.height(heights.less)}else{l.removeClass("m-scrollable-filter");l.height("auto")}}$(document).bind("m-filter-scroll-reset",function(e,code,itemCount){_itemCounts[code]=itemCount;var div=$("#"+prefix+code);var l=div.parent().children(":not(.m-option-search)").first();_initFilterScrollBar(l,code);l.parent().on("m-prepare",function(){_initFilterScrollBar(l,code)})});$(document).bind("m-ajax-before",function(e,selectors){_inAjax=true});$(document).bind("m-ajax-after",function(e,selectors){for(var code in _states){apply(code,false)}_inAjax=false});$("a.m-show-less-action").live("click",clickHandler);$("a.m-show-more-action").live("click",clickHandler)})(jQuery);if(!Control){var Control={}}Control.PriceSlider=Class.create();Control.PriceSlider.prototype={initialize:function(handle,track,options){var slider=this;if(handle instanceof Array){this.handles=handle.collect(function(e){return $(e)})}else{this.handles=[$(handle)]}this.track=$(track);this.options=options||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step||"1");this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0});this.spans=this.options.spans?this.options.spans.map(function(s){return $(s)}):false;this.options.startSpan=$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||"0");this.alignY=parseInt(this.options.alignY||"0");this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?this.handles[0].offsetHeight:this.handles[0].offsetWidth;this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled){this.setDisabled()}this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):false;if(this.allowedValues){this.minimum=this.allowedValues.min();this.maximum=this.allowedValues.max()}this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.handles.each(function(h,i){i=slider.handles.length-1-i;slider.setValue(parseFloat((slider.options.sliderValue instanceof Array?slider.options.sliderValue[i]:slider.options.sliderValue)||slider.range.start),i);Element.makePositioned(h);Event.observe(h,"mousedown",slider.eventMouseDown);Event.observe(h,"touchstart",slider.eventMouseDown)});Event.observe(this.track,"mousedown",this.eventMouseDown);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(this.track,"touchstart",this.eventMouseDown);Event.observe(document,"touchend",this.eventMouseUp);Event.observe(document,"touchmove",this.eventMouseMove);this.initialized=true},dispose:function(){var slider=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(this.track,"touchstart",this.eventMouseDown);Event.stopObserving(document,"touchend",this.eventMouseUp);Event.stopObserving(document,"touchmove",this.eventMouseMove);this.handles.each(function(h){Event.stopObserving(h,"mousedown",slider.eventMouseDown);Event.stopObserving(h,"touchstart",slider.eventMouseDown)})},setDisabled:function(){this.disabled=true},setEnabled:function(){this.disabled=false},getNearestValue:function(value){if(this.allowedValues){if(value>=this.allowedValues.max()){return(this.allowedValues.max())}if(value<=this.allowedValues.min()){return(this.allowedValues.min())}var offset=Math.abs(this.allowedValues[0]-value);var newValue=this.allowedValues[0];this.allowedValues.each(function(v){var currentOffset=Math.abs(v-value);if(currentOffset<=offset){newValue=v;offset=currentOffset}});return newValue}if(value>this.range.end){return this.range.end
}if(value<this.range.start){return this.range.start}return value},setValue:function(sliderValue,handleIdx){if(!this.active){this.activeHandle=this.handles[handleIdx];this.activeHandleIdx=handleIdx;this.updateStyles()}handleIdx=handleIdx||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((handleIdx>0)&&(sliderValue<this.values[handleIdx-1])){sliderValue=this.values[handleIdx-1]}if((handleIdx<(this.handles.length-1))&&(sliderValue>this.values[handleIdx+1])){sliderValue=this.values[handleIdx+1]}}sliderValue=this.getNearestValue(sliderValue);this.values[handleIdx]=sliderValue;this.value=this.values[0];this.handles[handleIdx].style[this.isVertical()?"top":"left"]=this.translateToPx(sliderValue,handleIdx);this.drawSpans();if(!this.dragging||!this.event){this.updateFinished()}},setValueBy:function(delta,handleIdx){this.setValue(this.values[handleIdx||this.activeHandleIdx||0]+delta,handleIdx||this.activeHandleIdx||0)},translateToPx:function(value,handleIdx){if(this.handles.length==2){if(handleIdx!=null){var offset=(value-this.range.start)/(this.range.end-this.range.start)*(this.trackLength-2*this.handleLength);if(handleIdx>0){return Math.round(offset+this.handleLength)+"px"}else{return Math.round(offset)+"px"}}else{var offset=(value-this.range.start)/(this.range.end-this.range.start)*(this.trackLength-2*this.handleLength);return Math.round(offset+this.handleLength)+"px"}}else{return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(value-this.range.start))+"px"}},translateToValue:function(offset){var percent=0;if(this.handles.length==2){if(this.activeHandleIdx>0){percent=(offset-1.5*this.handleLength)/(this.trackLength-2*this.handleLength)}else{percent=(offset+0.5*this.handleLength)/(this.trackLength-2*this.handleLength)}var value=percent*(this.range.end-this.range.start)+this.range.start;if(value<this.range.start){value=this.range.start}else{if(value>this.range.end){value=this.range.end}}return value}else{return((offset/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start)}},getRange:function(range){var v=this.values.sortBy(Prototype.K);range=range||0;return $R(v[range],v[range+1])},minimumOffset:function(){return(this.isVertical()?this.alignY:this.alignX)},maximumOffset:function(){return(this.isVertical()?this.track.offsetHeight-this.alignY:this.track.offsetWidth-this.alignX)},isVertical:function(){return(this.axis=="vertical")},drawSpans:function(){var slider=this;if(this.spans){$R(0,this.spans.length-1).each(function(r){slider.setSpan(slider.spans[r],slider.getRange(r))})}if(this.options.startSpan){this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value))}if(this.options.endSpan){this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum))}},setSpan:function(span,range){if(this.isVertical()){span.style.top=this.translateToPx(range.start,null);span.style.height=this.translateToPx(range.end-range.start+this.range.start,null)}else{span.style.left=this.translateToPx(range.start,null);span.style.width=this.translateToPx(range.end-range.start+this.range.start,null)}},updateStyles:function(){this.handles.each(function(h){Element.removeClassName(h,"selected")});Element.addClassName(this.activeHandle,"selected")},startDrag:function(event){if(Event.isLeftClick(event)||(Prototype.Browser.IE&&document.documentMode>=9&&event.buttons==1)||event.touches){if(!this.disabled){this.active=true;var handle=Event.element(event);var pointer=(event.touches?[event.touches[0].clientX,event.touches[0].clientY]:[Event.pointerX(event),Event.pointerY(event)]);if(handle==this.track){this.active=false}else{while((this.handles.indexOf(handle)==-1)&&handle.parentNode){handle=handle.parentNode}if(this.handles.indexOf(handle)!=-1){this.activeHandle=handle;this.activeHandleIdx=this.handles.indexOf(this.activeHandle);this.updateStyles();var offsets=Position.cumulativeOffset(this.activeHandle);this.offsetX=(pointer[0]-offsets[0]);this.offsetY=(pointer[1]-offsets[1])}else{this.active=false}}}Event.stop(event)}},update:function(event){if(this.active){if(!this.dragging){this.dragging=true}this.draw(event);if(Prototype.Browser.WebKit&&!event.touches){window.scrollBy(0,0)}Event.stop(event)}},draw:function(event){var pointer=(event.touches?[event.touches[0].clientX,event.touches[0].clientY]:[Event.pointerX(event),Event.pointerY(event)]);var offsets=Position.cumulativeOffset(this.track);pointer[0]-=this.offsetX+offsets[0];pointer[1]-=this.offsetY+offsets[1];this.event=event;this.setValue(this.translateToValue(this.isVertical()?pointer[1]:pointer[0]));if(this.initialized&&this.options.onSlide){this.options.onSlide(this.values.length>1?this.values:this.value,this)}},endDrag:function(event){if(this.active&&this.dragging){this.finishDrag(event,true);Event.stop(event)}this.active=false;this.dragging=false},finishDrag:function(event,success){this.active=false;this.dragging=false;
this.updateFinished()},updateFinished:function(){if(this.initialized&&this.options.onChange){this.options.onChange(this.values.length>1?this.values:this.value,this)}this.event=null},resize:function(){var slider=this;var onChange=this.options.onChange;this.options.onChange=null;this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?this.handles[0].offsetHeight:this.handles[0].offsetWidth;this.drawSpans();this.handles.each(function(h,i){i=slider.handles.length-1-i;slider.setValue(parseFloat((slider.options.sliderValue instanceof Array?slider.options.sliderValue[i]:slider.options.sliderValue)||slider.range.start),i);Element.makePositioned(h);Event.observe(h,"mousedown",slider.eventMouseDown);Event.observe(h,"touchstart",slider.eventMouseDown)});this.options.onChange=onChange},needsResize:function(){var trackLength=this.trackLength;if(this.maximumOffset()==this.minimumOffset()){return false}this.trackLength=this.maximumOffset()-this.minimumOffset();var range=this.getRange(0);var span=this.spans[0];var expectedWidth=this.translateToPx(range.end-range.start+this.range.start,null);this.trackLength=trackLength;return span.style.width!=expectedWidth}};var ManaPro=ManaPro||{};ManaPro.filterSlider=function(id,o){var s=new Control.PriceSlider([id+"-from",id+"-to"],id+"-track",{spans:[id+"-span"],restricted:true,range:$R(o.rangeFrom,o.rangeTo),sliderValue:[o.appliedFrom,o.appliedTo]});s.options.onSlide=function(value){var formattedValue=[o.numberFormat.replace("0",value[0].round()+""),o.numberFormat.replace("0",value[1].round()+"")];$(id+"-applied").update(o.appliedFormat.replace("__0__",formattedValue[0]).replace("__1__",formattedValue[1]))};s.options.onChange=function(value){if(value[0]<=o.rangeFrom&&value[1]>=o.rangeTo){window.setLocation(o.clearUrl)}else{var formattedValue=[value[0].round(),value[1].round()];window.setLocation(o.url.replace("__0__",formattedValue[0]).replace("__1__",formattedValue[1]))}}};var ManaPro=ManaPro||{};var _mana_oldResizehandler={};var _mana_sliderTimers={};ManaPro.filterSuperSlider=function(id,o){var _changing=false;var $_from=jQuery("#"+id+"-applied input.m-slider.m-from");var $_to=jQuery("#"+id+"-applied input.m-slider.m-to");var _value=[parseFloat($_from.val()),parseFloat($_to.val())];function _round(value){if(o.existingValues.length){var distance=0;var found=-1;o.existingValues.each(function(item,index){if(found==-1||distance>=Math.abs(item-value)){found=index;distance=Math.abs(item-value)}});value=parseFloat(o.existingValues[found])}if(o.formatThreshold&&value>=o.formatThreshold){return o.decimalDigits2?parseFloat(value.toFixed(o.decimalDigits2)):value.round()}else{return o.decimalDigits?parseFloat(value.toFixed(o.decimalDigits)):value.round()}}function _format(value){if(o.formatThreshold&&value>=o.formatThreshold){value=_round(value)/o.formatThreshold;value=o.decimalDigits2?value.toFixed(o.decimalDigits2):value.round();return o.numberFormat2.replace("0",_formatNumber(value,o.decimalDigits2)+"")}else{return o.numberFormat.replace("0",_formatNumber(_round(value),o.decimalDigits)+"")}}function _formatNumber(value,decPlaces){var thouSeparator=o.thousandSeparator?o.groupSymbol:"";var decSeparator=o.decimalSymbol;var n=value;var sign=n<0?"-":"",i=parseInt(n=Math.abs(+n||0).toFixed(decPlaces))+"",j=(j=i.length)>3?j%3:0;return sign+(j?i.substr(0,j)+thouSeparator:"")+i.substr(j).replace(/(\d{3})(?=\d)/g,"$1"+thouSeparator)+(decPlaces?decSeparator+Math.abs(n-i).toFixed(decPlaces).slice(2):"")}function _change(value,undefined){if(_changing){return}_changing=true;if(value===undefined){value=[parseFloat($_from.val()),parseFloat($_to.val())];if(value[0]==NaN||value[1]==NaN){_changing=false;return}if(value[0]==_value[0]&&value[1]==_value[1]){_changing=false;return}else{if(value[0]>value[1]){var t=value[0];value[0]=value[1];value[1]=t}}}if(value[0]<=o.rangeFrom&&value[1]>=o.rangeTo){window.setLocation(jQuery.base64_decode(o.clearUrl))}else{var formattedValue=[_round(value[0]),_round(value[1])];window.setLocation(jQuery.base64_decode(o.url).replace("__0__",formattedValue[0]).replace("__1__",formattedValue[1]))}_changing=false}var s=new Control.PriceSlider([id+"-from",id+"-to"],id+"-track",{spans:[id+"-span"],restricted:true,range:$R(o.rangeFrom,o.rangeTo),sliderValue:[o.appliedFrom,o.appliedTo]});s.options.onSlide=function(value){if(o.manualEntry){jQuery("#"+id+"-applied input.m-slider.m-from").val(_round(value[0]));jQuery("#"+id+"-applied input.m-slider.m-to").val(_round(value[1]))}else{var formattedValue=[_format(value[0]),_format(value[1])];$(id+"-applied").update(o.appliedFormat.replace("__0__",formattedValue[0]).replace("__1__",formattedValue[1]))}};s.options.onChange=_change;var _timer=null;$_from.change(function(event){if(!_timer){_timer=setTimeout(function(){clearTimeout(_timer);_timer=null;_change()},100)}}).keypress(function(e){if(e.which==13){if(!_timer){_timer=setTimeout(function(){clearTimeout(_timer);_timer=null;_change()},100)}}else{if(e.which==27){$_from.val(_value[0])
}}}).focus(function(){var self=this;var focusing=setTimeout(function(){clearTimeout(focusing);focusing=null;$(self).select()},100)});$_to.change(function(){if(_timer){clearTimeout(_timer);_timer=null}_change()}).keypress(function(e){if(e.which==13){if(_timer){clearTimeout(_timer);_timer=null}_change()}else{if(e.which==27){$_to.val(_value[1])}}}).focus(function(){if(_timer){clearTimeout(_timer);_timer=null}var self=this;var focusing=setTimeout(function(){clearTimeout(focusing);focusing=null;$(self).select()},100)}).blur(function(){if(_timer){clearTimeout(_timer);_timer=null}_change()});function _resizeSpanAndHandles(forceResize){var checkFrequency=100,stabilityPeriod=500;var checkingForStability=false,currentlyStableFor=0;if(forceResize===true){s.resize()}if(!_mana_sliderTimers[id]){_mana_sliderTimers[id]=setInterval(function(){if(s.needsResize()){s.resize();checkingForStability=false}else{if(!checkingForStability){checkingForStability=true;currentlyStableFor=0}else{if(currentlyStableFor>=stabilityPeriod){clearInterval(_mana_sliderTimers[id]);_mana_sliderTimers[id]=null}else{currentlyStableFor+=checkFrequency}}}},checkFrequency)}}if(_mana_oldResizehandler[id]){jQuery(window).unbind("resize",_mana_oldResizehandler[id]);_mana_oldResizehandler[id]=null}_mana_oldResizehandler[id]=_resizeSpanAndHandles;jQuery(_resizeSpanAndHandles);jQuery(window).bind("resize",_resizeSpanAndHandles);jQuery(document).bind("m-ajax-after",_resizeSpanAndHandles);jQuery("#"+id+"-track").parent().on("m-prepare",function(){_resizeSpanAndHandles(true)})};ManaPro.filterAttributeSlider=function(id,o){function _indexOf(valueId){var result=-1;o.existingValues.each(function(item,index){if(item.id==valueId){result=index}});return result}function _valueOf(index){index=index.round();return o.existingValues[index].id}function _labelOf(index){index=index.round();return o.existingValues[index].label}function _urlValueOf(index){index=index.round();return o.existingValues[index].url}function _prefixOf(index){index=index.round();return o.existingValues[index].prefix}function _change(value,undefined){var indexes=[value[0].round(),value[1].round()];s.values=indexes;s.value=s.values[0];s.handles[0].style[s.isVertical()?"top":"left"]=s.translateToPx(indexes[0],0);s.handles[1].style[s.isVertical()?"top":"left"]=s.translateToPx(indexes[1],1);s.drawSpans();if(indexes[0]<=_indexOf(o.rangeFrom)&&indexes[1]>=_indexOf(o.rangeTo)){window.setLocation(jQuery.base64_decode(o.clearUrl))}else{var formattedValue=_prefixOf(indexes[0])+_urlValueOf(indexes[0])+o.separator+_urlValueOf(indexes[1]);window.setLocation(jQuery.base64_decode(o.url).replace("__0__",formattedValue))}}var s=new Control.PriceSlider([id+"-from",id+"-to"],id+"-track",{spans:[id+"-span"],restricted:true,range:$R(_indexOf(o.rangeFrom),_indexOf(o.rangeTo)),sliderValue:[_indexOf(o.appliedFrom),_indexOf(o.appliedTo)]});s.options.onSlide=function(value){var formattedValue=[_labelOf(value[0]),_labelOf(value[1])];$(id+"-applied").update(o.appliedFormat.replace("__0__",formattedValue[0]).replace("__1__",formattedValue[1]))};s.options.onChange=_change;function _resizeSpanAndHandles(forceResize){var checkFrequency=100,stabilityPeriod=500;var checkingForStability=false,currentlyStableFor=0;if(forceResize===true){s.resize()}if(!_mana_sliderTimers[id]){_mana_sliderTimers[id]=setInterval(function(){if(s.needsResize()){s.resize();checkingForStability=false}else{if(!checkingForStability){checkingForStability=true;currentlyStableFor=0}else{if(currentlyStableFor>=stabilityPeriod){clearInterval(_mana_sliderTimers[id]);_mana_sliderTimers[id]=null}else{currentlyStableFor+=checkFrequency}}}},checkFrequency)}}if(_mana_oldResizehandler[id]){jQuery(window).unbind("resize",_mana_oldResizehandler[id]);_mana_oldResizehandler[id]=null}_mana_oldResizehandler[id]=_resizeSpanAndHandles;jQuery(_resizeSpanAndHandles);jQuery(window).bind("resize",_resizeSpanAndHandles);jQuery("#"+id+"-track").parent().on("m-prepare",function(){_resizeSpanAndHandles(true)})};ManaPro.filterRangeInput=function(id,o){var _changing=false;var $_from=jQuery("#"+id+"-applied input.m-slider.m-from");var $_to=jQuery("#"+id+"-applied input.m-slider.m-to");var _value=[parseFloat($_from.val()),parseFloat($_to.val())];function _round(value){if(o.formatThreshold&&value>=o.formatThreshold){return o.decimalDigits2?value.toFixed(o.decimalDigits2):value.round()}else{return o.decimalDigits?value.toFixed(o.decimalDigits):value.round()}}function _change(undefined){if(_changing){return}_changing=true;value=[parseFloat($_from.val()),parseFloat($_to.val())];if(value[0]==NaN||value[1]==NaN){_changing=false;return}if(value[0]==_value[0]&&value[1]==_value[1]){_changing=false;return}else{if(value[0]>value[1]){var t=value[0];value[0]=value[1];value[1]=t}}if(value[0]<=o.rangeFrom&&value[1]>=o.rangeTo){window.setLocation(jQuery.base64_decode(o.clearUrl))}else{var formattedValue=[_round(value[0]),_round(value[1])];window.setLocation(jQuery.base64_decode(o.url).replace("__0__",formattedValue[0]).replace("__1__",formattedValue[1]))
}_changing=false}var _timer=null;$_from.change(function(event){if(!_timer){_timer=setTimeout(function(){clearTimeout(_timer);_timer=null;_change()},100)}}).keypress(function(e){if(e.which==13){if(!_timer){_timer=setTimeout(function(){clearTimeout(_timer);_timer=null;_change()},100)}}else{if(e.which==27){$_from.val(_value[0])}}}).focus(function(){var self=this;var focusing=setTimeout(function(){clearTimeout(focusing);focusing=null;$(self).select()},100)});$_to.change(function(){if(_timer){clearTimeout(_timer);_timer=null}_change()}).keypress(function(e){if(e.which==13){if(_timer){clearTimeout(_timer);_timer=null}_change()}else{if(e.which==27){$_to.val(_value[1])}}}).focus(function(){if(_timer){clearTimeout(_timer);_timer=null}var self=this;var focusing=setTimeout(function(){clearTimeout(focusing);focusing=null;$(self).select()},100)}).blur(function(){if(_timer){clearTimeout(_timer);_timer=null}_change()})};(function($){var _isCollapsedByDefault=false;var _expandSelected=false;function _collapse(item,showEffect){var li=item.parent();if(!li.hasClass("m-animating")){if(showEffect){_saveState(item,true);li.addClass("m-animating");li.children("ul").slideUp("fast",function(){li.removeClass("m-animating").removeClass("m-expanded").addClass("m-collapsed")})}else{li.children("ul").hide();li.removeClass("m-expanded").addClass("m-collapsed")}}}function _expand(item,showEffect){var li=item.parent();if(!li.hasClass("m-animating")){if(showEffect){_saveState(item,false);li.addClass("m-animating");li.children("ul").slideDown("fast",function(){li.removeClass("m-animating").removeClass("m-collapsed").addClass("m-expanded")})}else{li.children("ul").show();li.removeClass("m-collapsed").addClass("m-expanded")}}}var _state={};function _saveState(item,liState){var tree=item.parents(".m-tree");if(tree.length){var treeId=tree[0].id;var itemId=item[0].id;var isCollapsed=liState;if(_isCollapsedByDefault){isCollapsed=!isCollapsed}if(!_state[treeId]){_state[treeId]={}}_state[treeId][itemId]=isCollapsed?1:0;$.post($.options("#m-tree").url,{state:_state})}}function _loadState(){_isCollapsedByDefault=$.options&&$.options("#m-tree")&&$.options("#m-tree").collapsedByDefault;_expandSelected=$.options&&$.options("#m-tree")&&$.options("#m-tree").expandSelected;if(!_state.length&&$.options&&$.options("#m-tree")&&$.options("#m-tree").state){_state=$.options("#m-tree").state}$(".m-tree-item").each(function(){var item=$(this);var tree=item.parents(".m-tree");if(tree.length){var li=item.parent();if(li.children("ul").length){var treeId=tree[0].id;var itemId=item[0].id;var isCollapsed;if(li.find("ul .m-selected-filter-item").length){isCollapsed=false}else{if(li.find(".m-selected-filter-item").length&&_expandSelected){isCollapsed=false}else{isCollapsed=_state[treeId]&&_state[treeId][itemId]==1;if(_isCollapsedByDefault){isCollapsed=!isCollapsed}}}if(isCollapsed){_collapse($(this),false)}else{_expand($(this),false)}}else{li.addClass("m-leaf")}}})}$(function(){_loadState();$(".m-tree-item").live("click",function(e){if($(e.target).prop("tagName").toLowerCase()=="a"){return true}if($(this).parent().hasClass("m-collapsed")){_expand($(this),true);return false}else{if($(this).parent().hasClass("m-expanded")){_collapse($(this),true);return false}}})});$(document).bind("m-ajax-after",function(e,selectors,productsClicked){_loadState()})})(jQuery);