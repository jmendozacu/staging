if(search_auto_complete){var SearchAutocomplete=Class.create({initialize:function(e,t,s,i,r){this.searchFieldId=e,this.containerId=t,this.interval=i,this.timer=0,this.currentQuery="",this.cache=[],this.url=s,this.message="",this.delay=!0,this.searchField=$(e),this.container=$(t),this.searchField.observe("keyup",this.getInput.bind(this)),this.searchField.observe("focus",this.onFocus.bind(this)),this.searchField.observe("blur",this.onBlur.bind(this)),this.searchParameter="",this.isValid=!1,this.oldPosition=0,void 0!=r&&(this.message=r),Ajax.Request.prototype.abort=function(){this.transport.onreadystatechange=Prototype.emptyFunction,this.transport.abort(),Ajax.activeRequestCount--},"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),this.rb=null,this.addResetButton(),this.searchField.getValue()!=r&&this.resetButton(!0),document.observe("click",this.documentClick)},onFocus:function(){var e=this.searchField.getValue().trim();e==this.message?this.searchField.setValue(""):e.length>1&&"string"==typeof this.cache[e]&&this.showResult(e.toLowerCase())},onBlur:function(){var e=this.searchField.getValue().trim();0==e.length&&this.searchField.setValue(this.message)},getInput:function(){var e=this.searchField.getValue().trim();if(this.validate(e)){clearTimeout(this.timer);var t=e.toLowerCase();if(this.searchParameter.length>0)if(void 0!=this.cache[t+"_"+this.searchParameter])this.showResult(t);else{var s=this;this.timer=setTimeout(function(){s.isValid&&s.search()},this.delay?this.interval:0)}else if("string"==typeof this.cache[t])this.showResult(t);else{var s=this;this.timer=setTimeout(function(){s.isValid&&s.search()},this.interval)}}else this.stopRequest(!1)},search:function(){var e=this.currentQuery,t=e.toLowerCase(),s=this;this.stopRequest(!0);var i={};i.q=e,0!=s.searchParameter.length&&(this.delay=!0,i.a=this.searchParameter),this.request=new Ajax.Request(this.url,{method:"GET",onSuccess:function(i){0!=s.searchParameter.length&&(t+="_"+s.searchParameter),s.cache[t]=i.responseText,s.spinner(!1),s.showResult(e.toLowerCase())},parameters:i})},validate:function(e){var t=!1;if(e.length>1){if(this.resetButton(!0),e!=this.message)for(var s=e.split(" "),i=0,r=s.length;r>i;i++)if(s[i].length>1){t=!0,this.currentQuery=e;break}}else this.resetButton();return this.isValid=t,t},showResult:function(e){0!=this.searchParameter.length&&(e+="_"+this.searchParameter),this.stopRequest(!1),this.container.update(this.cache[e]),this.container.show();var t=$$(".searchautocomplete-search").first();if(void 0!=t){var s=($$(".form-search").first(),$$('.form-search button[type="submit"]',".xsearch-submit").first(),t.offsetWidth-(this.searchField.offsetLeft+this.searchField.offsetWidth));t.setStyle({left:-s+"px"}),t.style.left=-s+"px"}},spinner:function(e){if(1==e){this.searchField.addClassName("spinner"),this.oldPosition=this.searchField.style.backgroundPosition;var t=this.searchField.offsetWidth-33;this.searchField.setStyle({"background-position-x":t+"px"}),this.searchField.style.backgroundPosition=t+"px"}else this.searchField.removeClassName("spinner"),this.searchField.style.backgroundPosition=this.oldPosition},stopRequest:function(e){"undefined"!=typeof this.request&&this.request.abort(),this.spinner(e)},addSearchParameter:function(e){this.searchParameter=e,this.delay=!1,this.getInput()},documentClick:function(e){var t=e.toElement||e.target;if("search"!=t.id&&"xsearch-change"!=t.className&&"xsearch-dropdown"!=t.className){var s=t.up(".searchautocomplete-search");void 0!=s&&s.innerHTML.length>1||(s=t.up(".xsearch-select"),void 0!=s&&s.innerHTML.length>1||$("search_autocomplete").hide())}},addResetButton:function(){this.searchField.insert({before:'<input class="reset-button" type="button" />'});var e=this;this.rb=$$(".reset-button").first();var t=e.searchField.offsetLeft+e.searchField.offsetWidth-15;$$("div.xsearch-select").length>0&&(t-=15),this.rb.style.left=t+"px",this.rb.observe("click",function(){e.stopRequest(),e.isValid=!1,e.searchField.value="",e.onBlur(),e.resetButton()}),this.resetButton()},resetButton:function(e){e&&1==e?this.rb.show():this.rb.hide()}}),searchFieldId="search";$(searchFieldId).stopObserving(),$("search_autocomplete").style.position="absolute";var autocomplete=new SearchAutocomplete(searchFieldId,"search_autocomplete",search_suggest_url,popup_delay,search_string)}