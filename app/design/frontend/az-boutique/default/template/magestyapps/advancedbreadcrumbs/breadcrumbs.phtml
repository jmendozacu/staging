<?php
/**
 * MagestyApps
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/osl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade the extension to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to https://www.magestyapps.com for more information or
 * send an email to office@magestyapps.com .
 *
 * @category    MagestyApps
 * @package     MagestyApps_AdvancedBreadcrumbs
 * @copyright   Copyright (c) 2016 MagestyApps (https://www.magestyapps.com)
 * @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */

$crumbsLevels = $this->getAllBreadcrumbs();
?>
<?php if($crumbsLevels && is_array($crumbsLevels)): ?>
<style>
    .breadcrumbs li.last { float: none; }
    .breadcrumbs li.last span { float: none; }
</style>
<div class="breadcrumbs">
    <?php foreach ($crumbsLevels as $crumbs): ?>
    <?php $addRS = true; ?>
    <ul <?php if ($addRS) { echo 'vocab="http://schema.org/" typeof="BreadcrumbList"'; } ?>>
        <li class="back"><a href="<?php echo isset($_SERVER['HTTP_REFERER']) ? $_SERVER['HTTP_REFERER'] : ''; ?>"><img src="<?php echo $this->getSkinUrl('images/breadcrumb_arrow.png'); ?>"><?php echo $this->__('Back'); ?></a></li>
        <?php $cnt = count($crumbs); $i = 1; ?>
        <?php foreach($crumbs as $_crumb): ?>

            <li <?php if ($i >= $cnt) { echo 'class="last"'; } ?>
                <?php if (!empty($_crumb['hidden'])) { echo 'style="visibility: hidden;"'; } ?>
                <?php if ($addRS = true) { echo 'property="itemListElement" typeof="ListItem"'; } ?>>
            <?php if(!empty($_crumb['link'])): ?>
                <a href="<?php echo $_crumb['link'] ?>" title="<?php echo $this->htmlEscape($_crumb['title']) ?>" property="item" typeof="WebPage">
                    <?php echo $this->htmlEscape($_crumb['title']) ?>
                    <meta property="name" content="<?php echo $this->htmlEscape($_crumb['title']) ?>" />
                </a>
                <meta property="position" content="<?php echo $i ?>" />
            <?php elseif($_crumb['last']): ?>
                <strong><?php echo $this->htmlEscape($_crumb['title']) ?></strong>
            <?php else: ?>
                <?php echo $this->htmlEscape($_crumb['title']) ?>
            <?php endif; ?>
            <?php if(!$_crumb['last']): ?>
                <span> / </span>
            <?php endif; ?>
            </li>

            <?php $i++; ?>
        <?php endforeach; ?>

    </ul>
    <?php endforeach; ?>
</div>
<?php endif; ?>
